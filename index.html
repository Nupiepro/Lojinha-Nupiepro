<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lojinha Nupiepro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --azul-deep: #1B1B3A; --laranja: #FF914D; --laranja-glow: rgba(255, 145, 77, 0.4);
            --fundo: #F2F4F8; --card-bg: #ffffff; --texto: #2D3436; 
            --verde-zap: #25D366; --vermelho-del: #FF4757;
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.03);
            --shadow-md: 0 8px 24px rgba(27, 27, 58, 0.08);
            --shadow-lg: 0 15px 40px rgba(27, 27, 58, 0.12);
            --glass: rgba(255, 255, 255, 0.85);
            --glass-border: 1px solid rgba(255, 255, 255, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; /* Fonte mais moderna que Poppins */
            background-color: var(--fundo); color: var(--texto); 
            padding-bottom: 140px; overflow-x: hidden;
            background-image: radial-gradient(circle at 10% 20%, rgba(27, 27, 58, 0.03) 0%, transparent 20%);
        }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--azul-deep); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.6s;
        }
        .splash-img { 
            width: 110px; height: 110px; border-radius: 50%; border: 3px solid var(--laranja);
            box-shadow: 0 0 30px var(--laranja-glow); animation: pulseLogo 2s infinite ease-in-out; object-fit: cover;
        }
        .splash-text { 
            color: white; margin-top: 20px; font-weight: 700; letter-spacing: 2px; 
            font-size: 0.9rem; text-transform: uppercase; opacity: 0; animation: fadeUp 0.8s forwards 0.3s;
        }
        @keyframes pulseLogo { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 145, 77, 0.4); } 70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(255, 145, 77, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 145, 77, 0); } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        /* --- HEADER PREMIUM --- */
        header {
            background: linear-gradient(145deg, #1B1B3A 0%, #252550 100%); color: white;
            padding: 30px 20px 85px 20px; border-radius: 0 0 45px 45px; text-align: center;
            box-shadow: 0 10px 30px rgba(27, 27, 58, 0.25); position: relative; overflow: hidden;
        }
        /* Efeito de brilho no fundo do header */
        header::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 60%); pointer-events: none;
        }

        .brand-logo {
            width: 80px; height: 80px; border-radius: 50%; border: 3px solid rgba(255,255,255,0.15);
            object-fit: cover; box-shadow: 0 8px 20px rgba(0,0,0,0.2); margin-bottom: 8px;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .brand-logo:active { transform: scale(0.95); }

        .brand { font-size: 1.8rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; margin: 0; line-height: 1; text-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .brand span { color: var(--laranja); }
        
        .store-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(255, 145, 77, 0.15); color: var(--laranja); border: 1px solid rgba(255, 145, 77, 0.3);
            padding: 4px 14px; border-radius: 20px; font-size: 0.7rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.5px; margin: 8px 0; backdrop-filter: blur(5px);
        }

        .sub-brand { font-size: 0.75rem; opacity: 0.8; font-weight: 400; line-height: 1.4; max-width: 85%; margin: 0 auto; }
        
        /* --- FILTROS GLOW --- */
        .filter-container { margin-top: -35px; position: relative; z-index: 20; padding: 0 20px; margin-bottom: 25px; }
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 5px 5px 15px 5px; scrollbar-width: none; justify-content: center; }
        .filter-btn {
            padding: 10px 22px; background: var(--card-bg); border: none; border-radius: 30px;
            font-size: 0.85rem; font-weight: 600; color: #888; white-space: nowrap;
            box-shadow: var(--shadow-sm); transition: all 0.3s ease; cursor: pointer;
        }
        .filter-btn.active { 
            background: var(--azul-deep); color: white; 
            box-shadow: 0 8px 20px rgba(27, 27, 58, 0.25); transform: translateY(-2px);
        }

        /* --- GRID DE PRODUTOS --- */
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; position: relative; z-index: 10; }
        @media(min-width: 768px) { .container { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 30px; } }

        .card {
            background: var(--card-bg); border-radius: 20px; overflow: hidden;
            box-shadow: var(--shadow-sm); display: flex; flex-direction: column;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); position: relative; border: 1px solid #f0f0f0;
        }
        .card:active { transform: scale(0.96); }

        .image-wrapper { width: 100%; aspect-ratio: 1 / 1; background: #f8f9fc; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .prod-img { width: 100%; height: 100%; object-fit: cover; z-index: 2; transition: transform 0.5s ease; }
        
        .share-btn {
            position: absolute; top: 12px; right: 12px; width: 36px; height: 36px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 5; color: var(--azul-deep); font-size: 0.9rem; cursor: pointer;
            transition: 0.2s;
        }
        .share-btn:active { transform: scale(0.85); background: var(--azul-deep); color: white; }

        .no-photo-placeholder { position: absolute; width: 100%; height: 100%; top: 0; left: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); color: var(--azul-deep); z-index: 1; }
        .no-photo-placeholder i { font-size: 2rem; margin-bottom: 8px; opacity: 0.4; }
        .no-photo-placeholder span { font-size: 0.7rem; font-weight: 700; opacity: 0.6; text-transform: uppercase; }

        .card-info { padding: 16px; text-align: center; display: flex; flex-direction: column; flex-grow: 1; cursor: pointer; }
        .card-title { font-size: 0.85rem; font-weight: 700; color: var(--azul-deep); line-height: 1.3; height: 36px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .card-price { font-size: 1.1rem; color: var(--laranja); font-weight: 800; margin-top: 6px; }
        .tap-hint { font-size: 0.65rem; color: #adb5bd; margin-top: auto; padding-top: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        /* --- MODAIS COM GLASSMORPHISM --- */
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(27, 27, 58, 0.6); backdrop-filter: blur(6px); z-index: 2000; display: none; justify-content: center; align-items: flex-end; opacity: 0; transition: opacity 0.3s; }
        .modal-bg.active { display: flex; opacity: 1; }
        
        .modal-panel {
            background: var(--card-bg); width: 100%; max-width: 500px;
            border-radius: 30px 30px 0 0; padding: 30px 25px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            max-height: 90vh; overflow-y: auto; position: relative;
        }
        @media(min-width: 600px) { .modal-bg { align-items: center; } .modal-panel { border-radius: 30px; } }

        .detail-img-box {
            width: 100%; height: 240px; background: #f4f6f9; border-radius: 20px; margin-bottom: 20px;
            display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; border: 1px solid #eee;
        }
        .detail-img { width: 100%; height: 100%; object-fit: contain; z-index: 2; position: relative; }
        .detail-title { font-size: 1.4rem; font-weight: 800; color: var(--azul-deep); line-height: 1.2; margin-bottom: 5px; }
        .detail-price { font-size: 1.8rem; color: var(--laranja); font-weight: 800; margin-bottom: 25px; display: inline-block; }

        /* Controles Form */
        .nice-select { width: 100%; padding: 16px; border-radius: 15px; border: 2px solid #eef2f6; background: #fff; font-size: 0.95rem; color: var(--texto); font-weight: 600; outline: none; margin-bottom: 20px; appearance: none; transition: 0.3s; }
        .nice-select:focus { border-color: var(--azul-deep); }
        
        .qty-wrapper { display: flex; align-items: center; justify-content: space-between; background: #f8f9fc; padding: 6px; border-radius: 16px; border: 1px solid #eee; margin-bottom: 25px; }
        .qty-btn { width: 48px; height: 48px; background: white; border: none; border-radius: 12px; font-size: 1.2rem; color: var(--azul-deep); font-weight: 700; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.05); transition: 0.2s; }
        .qty-btn:active { transform: scale(0.9); }
        .qty-num { font-size: 1.3rem; font-weight: 700; color: #333; }

        .btn-primary {
            width: 100%; padding: 18px; border: none; border-radius: 16px;
            background: var(--azul-deep); color: white; font-size: 1rem; font-weight: 700;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            cursor: pointer; transition: 0.2s; box-shadow: 0 8px 20px rgba(27, 27, 58, 0.2);
            position: relative; overflow: hidden;
        }
        .btn-primary::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.1); opacity: 0; transition: 0.2s; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-primary:active::after { opacity: 1; }

        /* Input Styles */
        .input-box { width: 100%; padding: 16px; border: 1px solid #e0e0e0; border-radius: 12px; margin-bottom: 12px; outline: none; font-size: 0.95rem; transition: all 0.3s; background: #fbfbfb; font-family: inherit; }
        .input-box:focus { border-color: var(--azul-deep); background: #fff; box-shadow: 0 0 0 3px rgba(27, 27, 58, 0.1); }
        
        .radio-option {
            padding: 16px; border: 1px solid #eee; border-radius: 12px; display: flex; align-items: center; gap: 12px;
            cursor: pointer; font-size: 0.95rem; font-weight: 500; transition: 0.2s; margin-bottom: 10px;
        }
        .radio-option:has(input:checked) { border-color: var(--laranja); background: #fffbf8; color: var(--laranja); font-weight: 700; box-shadow: inset 0 0 0 1px var(--laranja); }
        .radio-option input { accent-color: var(--laranja); width: 18px; height: 18px; }

        /* Cart List */
        .cart-list { list-style: none; margin: 15px 0 25px; max-height: 220px; overflow-y: auto; border: 1px solid #f0f0f0; border-radius: 16px; padding: 10px; background: #fafafa; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 10px; border-bottom: 1px solid #eee; }
        .cart-item:last-child { border-bottom: none; }
        .btn-trash { background: #fff0f0; color: var(--vermelho-del); width: 36px; height: 36px; border: none; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .btn-trash:active { background: #ffe0e0; }

        /* --- BARRA FLUTUANTE DE VIDRO --- */
        .float-bar {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%) translateY(150px);
            width: 90%; max-width: 450px; 
            background: rgba(27, 27, 58, 0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            color: white; padding: 14px 30px; border-radius: 50px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); z-index: 100;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid rgba(255,255,255,0.1); cursor: pointer;
        }
        .float-bar.visible { transform: translateX(-50%) translateY(0); }

        /* --- TOAST NOTIFICATION (Novo!) --- */
        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: white; color: var(--azul-deep); padding: 12px 25px;
            border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            font-weight: 600; font-size: 0.9rem; z-index: 3000;
            display: flex; align-items: center; gap: 10px;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #toast.show { transform: translateX(-50%) translateY(0); }
        #toast i { color: var(--verde-zap); font-size: 1.1rem; }

        footer { text-align: center; color: #aaa; font-size: 0.75rem; margin-top: 40px; font-weight: 500; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .close-btn { position: absolute; top: 20px; right: 20px; background: #f0f2f5; width: 32px; height: 32px; border-radius: 50%; border: none; font-size: 1rem; color: #555; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    </style>
</head>
<body>
    <div id="toast"><i class="fa-solid fa-circle-check"></i> Item adicionado √† sacola!</div>

    <div id="splash-screen">
        <img src="https://i.ibb.co/7hcph2F/download.jpg" alt="Logo" class="splash-img">
        <div class="splash-text">Lojinha Oficial Nupiepro</div>
    </div>
        <header>
        <img src="https://i.ibb.co/7hcph2F/download.jpg" alt="Logo" class="brand-logo">
        <h1 class="brand">Nupiee<span>Pro</span></h1>
        
        <div class="store-badge"><i class="fa-solid fa-store"></i> Loja Oficial</div>
        
        <div class="sub-brand">N√∫cleo Piauiense de Estudantes de Engenharia de Produ√ß√£o</div>
    </header>

    <div class="filter-container">
        <div class="filter-scroll">
            <button class="filter-btn active" onclick="filtrarProdutos('todos', this)">Todos</button>
            <button class="filter-btn" onclick="filtrarProdutos('camisa', this)">Camisas</button>
            <button class="filter-btn" onclick="filtrarProdutos('acessorio', this)">Acess√≥rios</button>
        </div>
    </div>

    <div class="container" id="vitrine-area"></div>

    <footer>
        Desenvolvido por <strong>Nupiepro 2026</strong> <i class="fa-solid fa-heart" style="color:var(--laranja); margin-left:3px;"></i>
    </footer>

    <div class="modal-bg" id="modal-details" onclick="fecharModais(event)">
        <div class="modal-panel">
            <button class="close-btn" onclick="fecharModais(null)"><i class="fa-solid fa-xmark"></i></button>

            <div class="detail-img-box">
                <img src="" id="detalhe-img" class="detail-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                <div id="detalhe-fallback" class="no-photo-placeholder" style="display:none; position:absolute; z-index:1;">
                    <i class="fa-solid fa-box-open"></i><span>Sem Foto</span>
                </div>
            </div>

            <h2 id="detalhe-nome" class="detail-title">Nome</h2>
            <div id="detalhe-preco" class="detail-price">R$ 0,00</div>

            <div id="wrapper-tamanho" style="display:none;">
                <label style="font-size:0.85rem; font-weight:700; color:#555; margin-bottom:8px; display:block;">Tamanho:</label>
                <select id="select-tamanho" class="nice-select">
                    <option value="P - BBL (Baby Look)">P - BBL (Baby Look)</option>
                    <option value="M - BBL (Baby Look)">M - BBL (Baby Look)</option>
                    <option value="G - BBL (Baby Look)">G - BBL (Baby Look)</option>
                    <option value="GG - BBL (Baby Look)">GG - BBL (Baby Look)</option>
                    <option value="P - Normal">P - Normal</option>
                    <option value="M - Normal">M - Normal</option>
                    <option value="G - Normal">G - Normal</option>
                    <option value="GG - Normal">GG - Normal</option>
                </select>
            </div>

            <label style="font-size:0.85rem; font-weight:700; color:#555; margin-bottom:8px; display:block;">Quantidade:</label>
            <div class="qty-wrapper">
                <button class="qty-btn" onclick="alterarQtd(-1)"><i class="fa-solid fa-minus"></i></button>
                <div class="qty-num" id="detalhe-qtd">1</div>
                <button class="qty-btn" onclick="alterarQtd(1)"><i class="fa-solid fa-plus"></i></button>
            </div>

            <button class="btn-primary" onclick="adicionarAoCarrinho()">Adicionar √† Sacola</button>
        </div>
    </div>

    <div class="modal-bg" id="modal-checkout" onclick="fecharModais(event)">
        <div class="modal-panel">
            <button class="close-btn" onclick="fecharModais(null)"><i class="fa-solid fa-xmark"></i></button>
            <h2 style="color:var(--azul-deep); margin-bottom:20px; font-size:1.4rem;">Finalizar Pedido</h2>

            <ul class="cart-list" id="lista-carrinho"></ul>

            <h3 style="color:var(--azul-deep); font-size:1rem; margin:20px 0 10px; font-weight:700;">Seus Dados</h3>
            <input type="text" id="nome-cliente" class="input-box" placeholder="Seu Nome Completo">
            <input type="tel" id="zap-cliente" class="input-box" placeholder="WhatsApp com DDD">

            <h3 style="color:var(--azul-deep); font-size:1rem; margin:20px 0 10px; font-weight:700;">Entrega</h3>
            <div class="radio-section">
                <label class="radio-option">
                    <input type="radio" name="entrega" value="Retirada UFPI" checked onchange="toggleEndereco()"> 
                    <i class="fa-solid fa-building-columns" style="color:#888;"></i> Retirada (UFPI)
                </label>
                <label class="radio-option">
                    <input type="radio" name="entrega" value="Entrega" onchange="toggleEndereco()"> 
                    <i class="fa-solid fa-motorcycle" style="color:#888;"></i> Entrega (Verif. Taxa)
                </label>
            </div>
            <div id="box-endereco" style="display:none;">
                <input type="text" id="endereco-cliente" class="input-box" placeholder="Endere√ßo para entrega">
            </div>

            <h3 style="color:var(--azul-deep); font-size:1rem; margin:20px 0 10px; font-weight:700;">Pagamento</h3>
            <div class="radio-section">
                <label class="radio-option"><input type="radio" name="pgto" value="PIX" checked> PIX</label>
                <label class="radio-option"><input type="radio" name="pgto" value="Dinheiro"> Dinheiro</label>
                <label class="radio-option"><input type="radio" name="pgto" value="Cart√£o"> Cart√£o</label>
            </div>

            <button class="btn-primary" style="background:var(--verde-zap); margin-top:10px;" onclick="enviarPedidoZap()">
                Enviar Pedido <i class="fa-brands fa-whatsapp"></i>
            </button>
        </div>
    </div>

    <div class="float-bar" id="barra-carrinho" onclick="abrirCheckout()">
        <div style="line-height:1.2;">
            <div id="barra-qtd" style="font-size: 0.75rem; opacity: 0.8; font-weight:500;">0 itens</div>
            <div id="barra-total" style="font-weight: 800; font-size: 1.15rem; color: var(--laranja);">R$ 0,00</div>
        </div>
        <div style="font-weight: 700; font-size:0.95rem;">Ver Sacola <i class="fa-solid fa-bag-shopping" style="margin-left:5px;"></i></div>
                </div>
                    <script>
        const whatsappDestino = "5586999976226"; 

        const produtos = [
            { id: 1, nome: "Camisa PRETA - Eng. Produ√ß√£o", preco: 38.00, tipo: "camisa", categoria: "camisa", img: "https://i.ibb.co/TDhnM6xW/unnamed.png" },
            { id: 2, nome: "Camisa BRANCA - Eng. Produ√ß√£o", preco: 38.00, tipo: "camisa", categoria: "camisa", img: "https://i.ibb.co/bM9mqjXS/unnamed-1.png" },
            { id: 3, nome: "Camisa AZUL - Eng. Produ√ß√£o", preco: 38.00, tipo: "camisa", categoria: "camisa", img: "https://i.ibb.co/qLzdtvkN/unnamed-2.png" },
            { id: 4, nome: "Ecobag Nupiepro", preco: 22.00, tipo: "unico", categoria: "acessorio", img: "https://i.ibb.co/7dj3kxt0/unnamed-3.png" },
            { id: 5, nome: "Bloco de Anota√ß√µes", preco: 16.00, tipo: "unico", categoria: "acessorio", img: "https://i.ibb.co/hxxnxrbF/unnamed-4.png" },
            { id: 6, nome: "Chaveiro Abridor", preco: 5.00, tipo: "unico", categoria: "acessorio", img: "https://i.ibb.co/Kj00Xbys/unnamed-5.png" },
            { id: 7, nome: "Bottons Personalizados", preco: 5.00, tipo: "unico", categoria: "acessorio", img: "" }
        ];

        let carrinho = [];
        let itemSelecionado = null;
        let qtdTemporaria = 1;
        let filtroAtual = 'todos';

        window.addEventListener('load', () => {
            const splash = document.getElementById('splash-screen');
            carregarDadosUsuario();
            carregarVitrine();
            setTimeout(() => {
                splash.classList.add('hidden');
                setTimeout(() => splash.style.display = 'none', 600);
            }, 2200);
        });

        // --- SISTEMA TOAST (Notifica√ß√£o) ---
        function mostrarToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerHTML = `<i class="fa-solid fa-circle-check"></i> ${msg}`;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        function filtrarProdutos(cat, btn) {
            filtroAtual = cat;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            carregarVitrine();
        }

        function compartilhar(id, event) {
            event.stopPropagation(); 
            const prod = produtos.find(p => p.id === id);
            const textoShare = `Olha o que encontrei na Lojinha Nupiepro: ${prod.nome} por R$ ${prod.preco.toFixed(2)}!`;
            if (navigator.share) {
                navigator.share({ title: 'Nupiepro Store', text: textoShare, url: window.location.href }).catch(console.error);
            } else {
                alert("Copie o link: " + window.location.href);
            }
        }

        const vitrineArea = document.getElementById('vitrine-area');
        
        function carregarVitrine() {
            vitrineArea.innerHTML = '';
            const produtosFiltrados = produtos.filter(p => filtroAtual === 'todos' || p.categoria === filtroAtual);

            produtosFiltrados.forEach(p => {
                let imgHTML = '';
                if(p.img && p.img.length > 5) {
                    imgHTML = `<img src="${p.img}" class="prod-img" referrerpolicy="no-referrer" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                               <div class="no-photo-placeholder" style="display:none;"><i class="fa-solid fa-image"></i><span>Ver Foto</span></div>`;
                } else {
                    let icon = p.nome.includes("Botton") ? "fa-certificate" : "fa-box-open";
                    imgHTML = `<div class="no-photo-placeholder"><i class="fa-solid ${icon}" style="color:var(--laranja)"></i><span>${p.nome}</span></div>`;
                }

                vitrineArea.innerHTML += `
                    <div class="card" onclick="abrirDetalhes(${p.id})">
                        <div class="share-btn" onclick="compartilhar(${p.id}, event)"><i class="fa-solid fa-share-nodes"></i></div>
                        <div class="image-wrapper">${imgHTML}</div>
                        <div class="card-info" onclick="abrirDetalhes(${p.id})">
                            <div class="card-title">${p.nome}</div>
                            <div class="card-price">R$ ${p.preco.toFixed(2).replace('.',',')}</div>
                            <div class="tap-hint">Ver Detalhes</div>
                        </div>
                    </div>
                `;
            });
        }

        function abrirDetalhes(id) {
            itemSelecionado = produtos.find(p => p.id === id);
            qtdTemporaria = 1;

            document.getElementById('detalhe-nome').innerText = itemSelecionado.nome;
            document.getElementById('detalhe-preco').innerText = `R$ ${itemSelecionado.preco.toFixed(2).replace('.',',')}`;
            document.getElementById('detalhe-qtd').innerText = qtdTemporaria;

            const imgEl = document.getElementById('detalhe-img');
            const fallbackEl = document.getElementById('detalhe-fallback');
            
            if(itemSelecionado.img) {
                imgEl.src = itemSelecionado.img; imgEl.style.display = 'block'; fallbackEl.style.display = 'none';
            } else {
                imgEl.style.display = 'none'; fallbackEl.style.display = 'flex';
                fallbackEl.querySelector('i').className = itemSelecionado.nome.includes("Botton") ? "fa-solid fa-certificate" : "fa-solid fa-box-open";
            }

            document.getElementById('wrapper-tamanho').style.display = (itemSelecionado.tipo === 'camisa') ? 'block' : 'none';
            document.getElementById('modal-details').classList.add('active');
        }

        function fecharModais(e) {
            if(e && e.target !== e.currentTarget) return;
            document.getElementById('modal-details').classList.remove('active');
            document.getElementById('modal-checkout').classList.remove('active');
        }

        function alterarQtd(valor) {
            qtdTemporaria += valor;
            if(qtdTemporaria < 1) qtdTemporaria = 1;
            document.getElementById('detalhe-qtd').innerText = qtdTemporaria;
        }

        function adicionarAoCarrinho() {
            let tamanhoEscolhido = '√önico';
            if(itemSelecionado.tipo === 'camisa') {
                tamanhoEscolhido = document.getElementById('select-tamanho').value;
            }

            const index = carrinho.findIndex(i => i.id === itemSelecionado.id && i.tamanho === tamanhoEscolhido);
            if(index >= 0) carrinho[index].qtd += qtdTemporaria;
            else carrinho.push({ ...itemSelecionado, tamanho: tamanhoEscolhido, qtd: qtdTemporaria });

            mostrarToast("Adicionado √† sacola!");
            document.getElementById('modal-details').classList.remove('active');
            atualizarBarraFlutuante();
        }

        function atualizarBarraFlutuante() {
            const bar = document.getElementById('barra-carrinho');
            if(carrinho.length > 0) bar.classList.add('visible');
            else bar.classList.remove('visible');

            const total = carrinho.reduce((acc, item) => acc + (item.preco * item.qtd), 0);
            const totalQtd = carrinho.reduce((acc, item) => acc + item.qtd, 0);

            document.getElementById('barra-total').innerText = `R$ ${total.toFixed(2).replace('.',',')}`;
            document.getElementById('barra-qtd').innerText = `${totalQtd} item(ns)`;
        }

        function abrirCheckout() {
            if(carrinho.length === 0) return;
            renderizarListaCarrinho();
            document.getElementById('modal-checkout').classList.add('active');
        }

        function renderizarListaCarrinho() {
            const lista = document.getElementById('lista-carrinho');
            lista.innerHTML = '';
            if(carrinho.length === 0) { fecharModais(null); return; }

            carrinho.forEach((item, idx) => {
                let subtitulo = `R$ ${item.preco.toFixed(2).replace('.',',')}`;
                if(item.tipo === 'camisa') subtitulo += ` | ${item.tamanho}`;
                lista.innerHTML += `
                    <li class="cart-item">
                        <div class="cart-item-info"><strong>${item.qtd}x ${item.nome}</strong><span>${subtitulo}</span></div>
                        <button class="btn-trash" onclick="removerDoCarrinho(${idx})"><i class="fa-solid fa-trash"></i></button>
                    </li>
                `;
            });
        }

        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarBarraFlutuante();
            renderizarListaCarrinho();
        }

        function toggleEndereco() {
            const tipoEntrega = document.querySelector('input[name="entrega"]:checked').value;
            document.getElementById('box-endereco').style.display = (tipoEntrega === 'Entrega') ? 'block' : 'none';
        }

        function salvarDadosUsuario(nome, zap, endereco) {
            localStorage.setItem('nupiepro_nome', nome);
            localStorage.setItem('nupiepro_zap', zap);
            localStorage.setItem('nupiepro_endereco', endereco);
        }

        function carregarDadosUsuario() {
            const nome = localStorage.getItem('nupiepro_nome');
            const zap = localStorage.getItem('nupiepro_zap');
            const endereco = localStorage.getItem('nupiepro_endereco');

            if(nome) document.getElementById('nome-cliente').value = nome;
            if(zap) document.getElementById('zap-cliente').value = zap;
            if(endereco) document.getElementById('endereco-cliente').value = endereco;
        }

        function enviarPedidoZap() {
            const nome = document.getElementById('nome-cliente').value;
            const zap = document.getElementById('zap-cliente').value;
            const tipoEntrega = document.querySelector('input[name="entrega"]:checked').value;
            const endereco = document.getElementById('endereco-cliente').value;
            const pgto = document.querySelector('input[name="pgto"]:checked').value;

            if(!nome || !zap) { alert("Preencha Nome e WhatsApp!"); return; }
            if(tipoEntrega === 'Entrega' && !endereco) { alert("Informe o endere√ßo!"); return; }

            salvarDadosUsuario(nome, zap, endereco);

            let msg = `*LOJINHA OFICIAL NUPIEPRO* ‚öôÔ∏è\n------------------------------\n`;
            msg += `üë§ *Cliente:* ${nome}\nüì± *WhatsApp:* ${zap}\n`;
            msg += `üöö *M√©todo:* ${tipoEntrega}\n`;
            if(tipoEntrega === 'Entrega') msg += `üìç *Endere√ßo:* ${endereco}\n`;
            msg += `üí≥ *Pagamento:* ${pgto}\n\n*ITENS DO PEDIDO:*\n`;
            
            carrinho.forEach(item => {
                msg += `üì¶ ${item.qtd}x *${item.nome}*\n`;
                if(item.tipo === 'camisa') msg += `   ‚îî Tam: ${item.tamanho}\n`;
                msg += `   ‚îî R$ ${(item.preco * item.qtd).toFixed(2).replace('.',',')}\n`;
            });

            const total = carrinho.reduce((acc, item) => acc + (item.preco * item.qtd), 0);
            msg += `\n------------------------------\n*üí∞ TOTAL: R$ ${total.toFixed(2).replace('.',',')}*\n------------------------------\n`;
            if(pgto === 'PIX') msg += `‚ÑπÔ∏è Aguardo a chave PIX.`;

            window.open(`https://wa.me/${whatsappDestino}?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
